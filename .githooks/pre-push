#!/bin/bash

# Pre-push hook: Prevent direct pushes to main branch
# All changes to main should go through Pull Requests

PROTECTED_BRANCH="main"
CURRENT_BRANCH=$(git symbolic-ref HEAD | sed -e 's,.*/\(.*\),\1,')

# Read the push destination
while read local_ref local_sha remote_ref remote_sha
do
    if [[ "$remote_ref" == "refs/heads/$PROTECTED_BRANCH" ]]; then
        if [[ "$CURRENT_BRANCH" == "$PROTECTED_BRANCH" ]]; then
            echo ""
            echo "ðŸš« Direct push to '$PROTECTED_BRANCH' is not allowed!"
            echo ""
            echo "Please create a feature branch and open a Pull Request:"
            echo "  git checkout -b feature/your-feature-name"
            echo "  git push origin feature/your-feature-name"
            echo "  # Then open a PR on GitHub"
            echo ""
            exit 1
        fi
    fi
done

exit 0
